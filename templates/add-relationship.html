<html>
  <head>
    <title>
      add-relationship
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- CSS only -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
      crossorigin="anonymous"
    />

    <link
      href="https://fonts.googleapis.com/css2?family=Maven+Pro&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <div class="container-sm">
	    <a href={{stage}} style="font-size: x-large;">Go Home</a>
      <!--
                these set of if statements is to set the values in the input to none if the submission was valid
        -->
      {% if status == "success" %} {% set f = none %} {% else %} {% set f = form
      %} {% endif %}
      <form
        class="form"
        id="form1"
        name="form1"
        action="{{stage}}/add-relationship"
        method="post"
      >
        <div class="form-group">
          <label>Topic</label>
          <select class="form-control" name="Topic">
            <option>Choose..</option>
            {% for t in topics %}
            <option>{{t}}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-group">
          <label>Application Name</label>
          <input
            type="text"
            class="form-control"
            id="formGroupExampleInput"
            name="Application_Name"
            placeholder="Application name"
            value="{{f.Application_Name}}"
          />
        </div>
        <div class="form-group">
          <label>Application Website</label>
          <input
            type="text"
            class="form-control"
            id="formGroupExampleInput3"
            name="site"
            placeholder="Website"
            value="{{f.site}}"
          />
        </div>
        <div class="form-group">
          <label>Publication Link</label>
          <input
            type="text"
            class="form-control"
            id="formGroupExampleInput4"
            name="Publication_Link"
            placeholder="Publication link"
            value="{{f.Publication_Link}}"
          />
        </div>
        <div class="form-group">
          <label>Dataset Name</label>
          <input
            type="text"
            class="form-control"
            id="formGroupExampleInput5"
            name="Dataset_Name"
            placeholder="Dataset name"
            value="{{f.Dataset_Name}}"
          />
        </div>
        <div class="form-group">
          <label>Dataset DOI</label>
          <input
            type="text"
            class="form-control"
            id="formGroupExampleInput2"
            name="DOI"
            placeholder="DOI"
            value="{{f.DOI}}"
          />
        </div>
      </form>
      <button
        class="btn btn-success btn-add"
        type="button"
        onclick="addFields()"
      >
        Add dataset
      </button>
      <button type= "button" class= "btn btn-primary" onclick="validate()">Submit</button>
      <script>
        var id_val = 0;
        var false_alert = "";
        function addFields() {
          id_val++;

          var ds_name = document.createElement("input");
          ds_name.type = "text";
          ds_name.className = "form-control";
          ds_name.placeholder = "Dataset Name " + id_val;
          ds_name.id = id_val;
          ds_name.name = "Dataset_Name_" + id_val;

          var lbl = document.createElement("label");
          var text = document.createTextNode("Dataset " + id_val);
          lbl.appendChild(text);
          var tag = document.createElement("div");
          tag.className = "form-group";
          tag.appendChild(lbl);
          tag.appendChild(ds_name);
          $("form").append(tag);
          //$(tag).insertBefore(".btn-success");

          var DOI = `<div class='form-group'>
            <label>Dataset DOI ${id_val}</label>
            <input
              type="text"
              class="form-control"
              id="DOI${id_val}"
              name="DOI_${id_val}"
              placeholder="DOI ${id_val}"
            />
            </div>`
          $("form").append(DOI);
            //$(DOI).insertBefore(".btn-success");
        }

        function validate() {
          var truth= true;
          f = document.forms["form1"];
          Object.entries(f).forEach(([key, value]) =>{
            console.log(value.value.length);
            console.log(value)
            if (value.value.length==0){
              truth=false;
            }
          }

          );

          if (truth){
            f.submit();
          }else{
            if (false_alert.length>5){
              return false;
            };
            false_alert =`<div class="alert alert-danger" id="failure" role="alert">
              invalid fields
            </div>`
            $(".btn-primary").after(false_alert);
          }
        }
      </script>

      <h1>your orcID:{{orcid}}</h1>
      {% if status == "success" %}
      <div class="alert alert-success" id="success" role="alert">
        Success! We've added your values to our database.
      </div>
      <h3>Values added to database:</h3>
      {% for key, value in form.items() %}
      <p>{{key}}: {{value}}</p>
      {% endfor %} {% endif %} {% if status == "failure" %}
      <div class="alert alert-danger" id="failure" role="alert">
        Either you are not authorized to add relations, or we have an internal server error.
      </div>
      {% endif %}
    </div>

    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
      integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
      integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
      crossorigin="anonymous"
    ></script>
    <style>
      .form-group {
        margin-bottom: 0.5rem;
      }
      .form {
        width: 50%;
      }
    </style>
  </body>
</html>

